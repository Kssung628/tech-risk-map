<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TRG Cube Academic Edition</title>
<script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
<style>
body{margin:0;font-family:Arial;background:#0b0f17;color:white}
#toolbar{padding:10px;background:#111}
#cy{width:100%;height:90vh}
button,select{margin-right:8px}
.hidden{display:none}
.dim{opacity:0.15}
</style>
</head>
<body>

<div id="toolbar">
<button id="fit">Fit</button>
<select id="view">
<option value="layer">Layer View</option>
<option value="risk">Risk View</option>
</select>

<select id="phase">
<option value="all">All</option>
<option value="pre">Pre</option>
<option value="ops">Ops</option>
<option value="post">Post</option>
</select>

<label>
<input type="checkbox" id="regToggle"> Show Regulatory
</label>

<button id="export">Export PNG</button>
</div>

<div id="cy"></div>

<script>

fetch("data.json").then(r=>r.json()).then(data=>{

const cy = cytoscape({
container: document.getElementById("cy"),
elements: [
...data.nodes.map(n=>({data:n})),
...data.edges.map(e=>({data:e}))
],
style:[
{selector:"node",style:{
"label":"data(name)",
"background-color":"#60a5fa",
"color":"white",
"text-wrap":"wrap",
"text-max-width":120
}},
{selector:"edge",style:{
"width":2,
"line-color":"#888",
"target-arrow-shape":"triangle",
"target-arrow-color":"#888",
"curve-style":"bezier"
}},
{selector:".dim",style:{opacity:0.15}}
],
layout:{name:"cose"}
});

function applyPhase(){
let p=document.getElementById("phase").value;
cy.nodes().forEach(n=>{
let ph=n.data("phase")||"all";
n.toggleClass("dim",!(p==="all"||ph==="all"||ph===p));
});
}

function applyReg(){
let show=document.getElementById("regToggle").checked;
cy.nodes().forEach(n=>{
if(n.data("tier")==="reg"&&!show) n.style("display","none");
else n.style("display","element");
});
}

document.getElementById("phase").onchange=applyPhase;
document.getElementById("regToggle").onchange=applyReg;

document.getElementById("fit").onclick=()=>cy.fit();
document.getElementById("export").onclick=()=>{
let png=cy.png({bg:"#fff"});
let a=document.createElement("a");
a.href=png;
a.download="trg.png";
a.click();
};

});

</script>
</body>
</html>
