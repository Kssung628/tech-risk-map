<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>科技風險治理整合總圖（互動版）</title>

  <style>
    :root{
      --bg:#0b0f17;
      --panel:#111827;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:#1f2937;
      --accent:#60a5fa;
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(96,165,250,.18), transparent 60%),
                  radial-gradient(1000px 700px at 80% 30%, rgba(167,139,250,.14), transparent 60%),
                  var(--bg);
      color: var(--text);
    }
    header{
      padding: 18px 16px 12px;
      border-bottom: 1px solid var(--line);
      background: rgba(17,24,39,.55);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .wrap{ max-width: 1200px; margin: 0 auto; }
    h1{ margin:0 0 6px 0; font-size: 18px; letter-spacing:.2px; }
    .subtitle{ color: var(--muted); font-size: 13px; line-height: 1.55; }

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .tab{
      background: rgba(15,23,42,.7);
      border: 1px solid var(--line);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 13px;
      user-select: none;
    }
    .tab.active{
      border-color: rgba(96,165,250,.55);
      box-shadow: 0 0 0 3px rgba(96,165,250,.12);
    }

    main{ padding: 16px; }

    .grid{
      display:grid;
      grid-template-columns: 1.55fr .85fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      header{ position: relative; }
    }

    .card{
      background: rgba(15,23,42,.7);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
    }
    .card h2{
      margin:0 0 8px 0;
      font-size: 14px;
      color:#f3f4f6;
    }
    .note{
      margin: 0 0 10px 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    /* ===== Diagram & zoom ===== */
    .diagram{
      position: relative;
      overflow:auto;
      border-radius: 12px;
      border: 1px dashed rgba(148,163,184,.28);
      padding: 10px;
      background: rgba(2,6,23,.45);
    }
    .diagram-toolbar{
      position: sticky;
      top: 8px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-bottom: 8px;
      z-index: 5;
    }
    .zoom-btn{
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: rgba(17,24,39,.6);
      color: var(--text);
      cursor: pointer;
      font-size: 12px;
    }
    .zoom-btn:hover{ border-color: rgba(96,165,250,.55); }
    .mermaid-wrap{ transform-origin: top left; }
    .mermaid svg{ max-width: 100%; height: auto; }

    .list{ display:flex; flex-direction: column; gap: 10px; margin-top: 10px; }
    .item{
      border: 1px solid var(--line);
      background: rgba(2,6,23,.35);
      border-radius: 12px;
      padding: 10px;
    }
    .k{ font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .v{ font-size: 13px; line-height: 1.6; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    .page{ display:none; }
    .page.active{ display:block; }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: rgba(17,24,39,.55);
      color: var(--text);
      cursor: pointer;
      font-size: 12px;
    }
    .btn:hover{ border-color: rgba(96,165,250,.55); }

    footer{
      border-top: 1px solid var(--line);
      padding: 14px 16px;
      color: var(--muted);
      font-size: 12px;
      margin-top: 18px;
    }
    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }
  </style>

  <!-- Mermaid v10+ (ESM). We render manually to ensure hidden tabs also render. -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    mermaid.initialize({
      startOnLoad: false,            // important: manual render
      securityLevel: "loose",        // allow click callbacks
      theme: "dark",
      themeVariables: {
        darkMode: true,
        fontFamily: 'ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial',
        fontSize: "18px",            // bigger default text
        primaryTextColor: "#e5e7eb",
        lineColor: "#94a3b8",
      },
      flowchart: { curve: "basis" }
    });

    async function renderAll(){
      const nodes = document.querySelectorAll(".mermaid");
      // Allow re-render (especially after tab switching)
      nodes.forEach(n => n.removeAttribute("data-processed"));
      await mermaid.run({ querySelector: ".mermaid" });
    }

    window.__renderAllMermaid = renderAll;

    window.addEventListener("DOMContentLoaded", () => {
      renderAll();
    });
  </script>
</head>

<body>
<header>
  <div class="wrap">
    <h1>科技風險治理整合總圖（Technology Risk Governance Integrated Map）</h1>
    <div class="subtitle">
      四頁互動版：每頁都有 Mermaid 圖；支援放大/縮小；切換分頁會自動重繪。<br/>
      點節點可開 Notion（請在 NOTION_LINKS 貼上各筆條目的 Share-to-web 連結）。
    </div>

    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="p1">1) 整體結構圖</div>
      <div class="tab" data-tab="p2">2) 核心交叉結構</div>
      <div class="tab" data-tab="p3">3) 垂直治理堆疊</div>
      <div class="tab" data-tab="p4">4) 台灣定位與狀態</div>
    </div>
  </div>
</header>

<main class="wrap">

  <!-- PAGE 1 -->
  <section class="page active" id="p1">
    <div class="grid">
      <div class="card">
        <h2>1) 整體結構圖（六層治理架構）</h2>
        <p class="note">字太小可用右上角放大。點節點可開 Notion 對應頁。</p>

        <div class="diagram" id="diag-p1">
          <div class="diagram-toolbar">
            <button class="zoom-btn" onclick="setZoom('diag-p1', 0.1)">放大＋</button>
            <button class="zoom-btn" onclick="setZoom('diag-p1', -0.1)">縮小－</button>
            <button class="zoom-btn" onclick="resetZoom('diag-p1')">重置</button>
          </div>

          <div class="mermaid-wrap" data-zoom="1">
            <div class="mermaid">
flowchart TB
  classDef soft fill:#0b1220,stroke:#334155,stroke-width:1px,color:#e5e7eb;
  classDef law fill:#111827,stroke:#64748b,stroke-width:1px,color:#e5e7eb;
  classDef sys fill:#0f172a,stroke:#60a5fa,stroke-width:1px,color:#e5e7eb;
  classDef fw fill:#0b1220,stroke:#a78bfa,stroke-width:1px,color:#e5e7eb;
  classDef tech fill:#0b1220,stroke:#f59e0b,stroke-width:1px,color:#e5e7eb;
  classDef sector fill:#0b1220,stroke:#22c55e,stroke-width:1px,color:#e5e7eb;

  L1["Layer 1<br/>價值/原則層<br/>OECD / UNESCO / G7"]:::soft
  L2["Layer 2<br/>強制法律/監管層<br/>EU AI Act / DORA / NIS2 / CRA / GDPR<br/>台灣：AI基本法 / 資安法 / 個資法"]:::law
  L3["Layer 3<br/>管理系統層<br/>ISO 42001 / ISO 23894 / ISO 27001/27701 / ISO 22301"]:::sys
  L4["Layer 4<br/>操作框架層<br/>NIST AI RMF / NIST CSF 2.0 / RMF / 800-53"]:::fw
  L5["Layer 5<br/>技術控制層<br/>Red Team / Model Testing / LLM Security"]:::tech
  L6["Layer 6<br/>產業監理層<br/>FSC AI 指引 / 平台反詐 / 醫療/電信等"]:::sector

  L1 --> L2 --> L3 --> L4 --> L5 --> L6

  L2 --> EU["EU AI Act"]:::law
  L2 --> DORA["DORA"]:::law
  L2 --> NIS2["NIS2"]:::law
  L2 --> CRA["EU CRA"]:::law
  L2 --> GDPR["GDPR"]:::law
  L2 --> TWAI["台灣：AI基本法"]:::law
  L2 --> TWCS["台灣：資安管理法"]:::law
  L2 --> TWPD["台灣：個資法/PDPC"]:::law
  L2 --> TWFP["台灣：反詐/平台驗證"]:::law

  L3 --> ISO42001["ISO/IEC 42001"]:::sys
  L3 --> ISO23894["ISO/IEC 23894"]:::sys
  L3 --> ISO27001["ISO/IEC 27001"]:::sys
  L3 --> ISO27701["ISO/IEC 27701"]:::sys
  L3 --> ISO22301["ISO 22301"]:::sys

  L4 --> NAI["NIST AI RMF"]:::fw
  L4 --> NCSF["NIST CSF 2.0"]:::fw

  click EU call __open("EU_AI_ACT")
  click DORA call __open("DORA")
  click NIS2 call __open("NIS2")
  click CRA call __open("EU_CRA")
  click GDPR call __open("GDPR")
  click ISO42001 call __open("ISO_42001")
  click ISO23894 call __open("ISO_23894")
  click ISO27001 call __open("ISO_27001")
  click ISO27701 call __open("ISO_27701")
  click ISO22301 call __open("ISO_22301")
  click NAI call __open("NIST_AI_RMF")
  click NCSF call __open("NIST_CSF_2")
  click TWAI call __open("TW_AI_ACT")
  click TWCS call __open("TW_CYBER_ACT")
  click TWPD call __open("TW_PDPA_PDPC")
  click TWFP call __open("TW_FRAUD_PLATFORM")
            </div>
          </div>
        </div>
      </div>

      <aside class="card">
        <h2>Notion 連結設定</h2>
        <p class="note">
          每個節點點擊會用 Node Key 打開 Notion。<br/>
          請在頁面底部的 <span class="mono">NOTION_LINKS</span> 物件貼上對應 Notion 公開連結。
        </p>
        <div class="list">
          <div class="item">
            <div class="k">快速檢查</div>
            <div class="v">
              <button class="btn" onclick="__showMissing()">顯示尚未設定連結的 Node Key</button>
            </div>
          </div>
          <div class="item">
            <div class="k">常見 Key</div>
            <div class="v mono">EU_AI_ACT / DORA / NIS2 / EU_CRA / GDPR / ISO_42001 / NIST_AI_RMF / TW_AI_ACT ...</div>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- PAGE 2 -->
  <section class="page" id="p2">
    <div class="grid">
      <div class="card">
        <h2>2) 核心交叉結構（五軸風險宇宙）</h2>
        <p class="note">每個風險軸也可以做成資料庫一筆（AI_RISK 等），點擊就能進 Notion。</p>

        <div class="diagram" id="diag-p2">
          <div class="diagram-toolbar">
            <button class="zoom-btn" onclick="setZoom('diag-p2', 0.1)">放大＋</button>
            <button class="zoom-btn" onclick="setZoom('diag-p2', -0.1)">縮小－</button>
            <button class="zoom-btn" onclick="resetZoom('diag-p2')">重置</button>
          </div>

          <div class="mermaid-wrap" data-zoom="1">
            <div class="mermaid">
flowchart LR
  classDef axis fill:#0b1220,stroke:#334155,stroke-width:1px,color:#e5e7eb;
  classDef ref fill:#0f172a,stroke:#60a5fa,stroke-width:1px,color:#e5e7eb;

  AI["AI Risk"]:::axis
  CY["Cyber Risk"]:::axis
  PR["Privacy Risk"]:::axis
  SC["Supply-chain Risk"]:::axis
  SE["Sector/Regulatory Risk"]:::axis

  AI --- CY
  AI --- PR
  AI --- SC
  AI --- SE
  CY --- SC
  PR --- SC
  PR --- SE
  CY --- SE

  EU["EU AI Act"]:::ref --> AI
  DORA["DORA"]:::ref --> CY
  DORA --> SC
  NIS2["NIS2"]:::ref --> CY
  GDPR["GDPR"]:::ref --> PR
  ISO["ISO 42001/23894"]:::ref --> AI
  NIST["NIST AI RMF/CSF"]:::ref --> AI
  NIST --> CY

  click AI call __open("AI_RISK")
  click CY call __open("CYBER_RISK")
  click PR call __open("PRIVACY_RISK")
  click SC call __open("SUPPLYCHAIN_RISK")
  click SE call __open("SECTOR_RISK")

  click EU call __open("EU_AI_ACT")
  click DORA call __open("DORA")
  click NIS2 call __open("NIS2")
  click GDPR call __open("GDPR")
  click ISO call __open("ISO_42001")
  click NIST call __open("NIST_AI_RMF")
            </div>
          </div>
        </div>
      </div>

      <aside class="card">
        <h2>建議你在 Notion 加 5 筆「風險軸」條目</h2>
        <div class="list">
          <div class="item">
            <div class="k">Node Key</div>
            <div class="v mono">AI_RISK / CYBER_RISK / PRIVACY_RISK / SUPPLYCHAIN_RISK / SECTOR_RISK</div>
          </div>
          <div class="item">
            <div class="k">用途</div>
            <div class="v">每條交叉邊可放案例、控制清單、指標（KRI）與教材。</div>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- PAGE 3 -->
  <section class="page" id="p3">
    <div class="grid">
      <div class="card">
        <h2>3) 治理層級垂直架構＋對應工具</h2>
        <p class="note">點右側工具群組可進入你在 Notion 的「層級總覽頁」（meta nodes）。</p>

        <div class="diagram" id="diag-p3">
          <div class="diagram-toolbar">
            <button class="zoom-btn" onclick="setZoom('diag-p3', 0.1)">放大＋</button>
            <button class="zoom-btn" onclick="setZoom('diag-p3', -0.1)">縮小－</button>
            <button class="zoom-btn" onclick="resetZoom('diag-p3')">重置</button>
          </div>

          <div class="mermaid-wrap" data-zoom="1">
            <div class="mermaid">
flowchart TB
  classDef lvl fill:#0b1220,stroke:#334155,stroke-width:1px,color:#e5e7eb;
  classDef tool fill:#0f172a,stroke:#60a5fa,stroke-width:1px,color:#e5e7eb;

  V1["Level 1 原則/價值"]:::lvl --> V2["Level 2 法規/監管義務"]:::lvl --> V3["Level 3 管理系統"]:::lvl --> V4["Level 4 操作框架"]:::lvl --> V5["Level 5 技術控制"]:::lvl --> V6["Level 6 監測與預警"]:::lvl

  T1["OECD/UNESCO/G7"]:::tool --- V1
  T2["EU AI Act / DORA / NIS2 / CRA / GDPR"]:::tool --- V2
  T3["ISO 42001/23894/27001/27701/22301"]:::tool --- V3
  T4["NIST AI RMF/CSF2/RMF/800-53"]:::tool --- V4
  T5["Red Team / Testing / LLM Security"]:::tool --- V5
  T6["KRI/KPI / Dashboard / Tabletop"]:::tool --- V6

  click T1 call __open("PRINCIPLES_LAYER")
  click T2 call __open("HARDLAW_LAYER")
  click T3 call __open("MANAGEMENT_SYSTEM_LAYER")
  click T4 call __open("OPERATIONAL_FRAMEWORK_LAYER")
            </div>
          </div>
        </div>
      </div>

      <aside class="card">
        <h2>Meta 節點（建議新增 4 筆）</h2>
        <div class="list">
          <div class="item">
            <div class="k">Node Key</div>
            <div class="v mono">PRINCIPLES_LAYER / HARDLAW_LAYER / MANAGEMENT_SYSTEM_LAYER / OPERATIONAL_FRAMEWORK_LAYER</div>
          </div>
          <div class="item">
            <div class="k">用途</div>
            <div class="v">把每層的「方法論、交付物、稽核證據鏈」放在這四頁，之後節點頁回連它們。</div>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- PAGE 4 -->
  <section class="page" id="p4">
    <div class="grid">
      <div class="card">
        <h2>4) 台灣定位與狀態（分層標註）</h2>
        <p class="note">這張圖把台灣進展與缺口視覺化（缺口可直接產品化：分級制度、assurance、審計/測試）。</p>

        <div class="diagram" id="diag-p4">
          <div class="diagram-toolbar">
            <button class="zoom-btn" onclick="setZoom('diag-p4', 0.1)">放大＋</button>
            <button class="zoom-btn" onclick="setZoom('diag-p4', -0.1)">縮小－</button>
            <button class="zoom-btn" onclick="resetZoom('diag-p4')">重置</button>
          </div>

          <div class="mermaid-wrap" data-zoom="1">
            <div class="mermaid">
flowchart TB
  classDef ok fill:#06240f,stroke:#22c55e,color:#e5e7eb;
  classDef warn fill:#2a1d07,stroke:#f59e0b,color:#e5e7eb;
  classDef info fill:#1a1233,stroke:#a78bfa,color:#e5e7eb;
  classDef todo fill:#0b1220,stroke:#94a3b8,color:#e5e7eb;

  TW2["台灣：AI基本法（已通過）"]:::ok
  TW3["台灣：資安管理法（已公布待施行）"]:::warn
  TW4["台灣：個資法/PDPC（已公布待施行）"]:::warn
  TW5["台灣：FSC 金融業 AI 指引（已發布）"]:::info
  TW6["高風險AI分級與文件義務（待建置）"]:::todo
  TW7["Assurance/審計制度化（待建置）"]:::todo

  TW2 --> TW3 --> TW4 --> TW5
  TW2 --> TW6 --> TW7

  click TW2 call __open("TW_AI_ACT")
  click TW3 call __open("TW_CYBER_ACT")
  click TW4 call __open("TW_PDPA_PDPC")
  click TW5 call __open("TW_FSC_AI_GUIDE")
  click TW6 call __open("TW_HIGH_RISK_CLASSIFICATION")
  click TW7 call __open("TW_AI_ASSURANCE_AUDIT")
            </div>
          </div>
        </div>
      </div>

      <aside class="card">
        <h2>缺口＝研究議程＝產品化切口</h2>
        <div class="list">
          <div class="item">
            <div class="k">制度缺口</div>
            <div class="v">高風險 AI 分級＋文件義務（TW_HIGH_RISK_CLASSIFICATION）</div>
          </div>
          <div class="item">
            <div class="k">Assurance 缺口</div>
            <div class="v">第三方測試/審計/上市後監控制度化（TW_AI_ASSURANCE_AUDIT）</div>
          </div>
          <div class="item">
            <div class="k">下一步可做</div>
            <div class="v">加入「狀態篩選器」與「hover tooltip 顯示 Summary」。</div>
          </div>
        </div>
      </aside>
    </div>
  </section>

</main>

<footer class="wrap">
  使用方式：存成 <span class="mono">index.html</span> → 上傳 GitHub Pages/Vercel/Netlify → 在 Notion 用 <span class="mono">/embed</span> 嵌入部署網址。<br/>
  若點節點沒反應：請先填 <span class="mono">NOTION_LINKS</span>，再按「顯示尚未設定連結的 Node Key」檢查。
</footer>

<script>
  // ====== Zoom controls ======
  function setZoom(containerId, delta){
    const wrap = document.querySelector(`#${containerId} .mermaid-wrap`);
    if (!wrap) return;
    const current = Number(wrap.dataset.zoom || "1");
    const next = Math.min(2.4, Math.max(0.7, current + delta));
    wrap.dataset.zoom = String(next);
    wrap.style.transform = `scale(${next})`;
  }
  function resetZoom(containerId){
    const wrap = document.querySelector(`#${containerId} .mermaid-wrap`);
    if (!wrap) return;
    wrap.dataset.zoom = "1";
    wrap.style.transform = "scale(1)";
  }

  // ====== Notion Links (paste your Share-to-web URLs here) ======
  const NOTION_LINKS = {
  // ===== EU / International hard law =====
  EU_AI_ACT: "https://eur-lex.europa.eu/legal-content/EN/TXT/PDF/?uri=OJ%3AL_202401689",
  DORA: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32022R2554",
  NIS2: "https://eur-lex.europa.eu/eli/dir/2022/2555/oj/eng",          // 建議用 NIS2（取代 EU_NIS2）
  EU_CRA: "https://eur-lex.europa.eu/eli/reg/2024/2847/oj/eng",
  GDPR: "https://eur-lex.europa.eu/eli/reg/2016/679/oj",          // 建議用 GDPR（取代 EU_GDPR）

  // ===== Taiwan hard law / sectoral =====
  TW_AI_ACT: "https://moda.gov.tw/en/press/press-releases/18316",
  TW_CYBER_ACT: "https://moda.gov.tw/en/ACS/laws/regulations/518",
  TW_PDPA_PDPC: "https://law.moj.gov.tw/eng/LawClass/LawAll.aspx?PCode=I0050021",
  TW_FRAUD_PLATFORM: "https://moda.gov.tw/en/major-policies/three-arrows-for-digital-development/1673",
  TW_FSC_AI_GUIDE: "https://www.fsc.gov.tw/en/",
  TW_HIGH_RISK_CLASSIFICATION: "PASTE_NOTION_PAGE_LINK",
  TW_AI_ASSURANCE_AUDIT: "PASTE_NOTION_PAGE_LINK",

  // ===== Soft law / principles =====
  OECD_AI_PRINCIPLES: "https://oecd.ai/en/ai-principles",
  UNESCO_AI_ETHICS: "https://unesdoc.unesco.org/ark:/48223/pf0000380455",
  G7_HIROSHIMA_PROCESS: "https://www.mofa.go.jp/files/100573471.pdf",
  BLETCHLEY_DECLARATION: "https://www.gov.uk/government/publications/ai-safety-summit-2023-the-bletchley-declaration/the-bletchley-declaration-by-countries-attending-the-ai-safety-summit-1-2-november-2023",
  US_AI_EO_14110: "https://www.federalregister.gov/documents/2023/11/01/2023-24283/safe-secure-and-trustworthy-development-and-use-of-artificial-intelligence",

  // ===== ISO standards =====
  ISO_42001: "https://www.iso.org/standard/42001",
  ISO_23894: "https://www.iso.org/standard/77304.html",
  ISO_31000: "https://www.iso.org/standard/65694.html",
  ISO_27001: "https://www.iso.org/standard/27001",
  ISO_27701: "https://www.iso.org/standard/71670.html",
  ISO_22301: "https://www.iso.org/standard/75106.html",
  ISO_38507: "https://www.iso.org/standard/56641.html",
  ISO_IEC_27036_SUPPLYCHAIN: "https://www.iso.org/standard/82890.html",

  // ===== NIST frameworks / controls =====
  NIST_AI_RMF: "https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf",
  NIST_CSF_2: "https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.29.pdf",
  NIST_RMF_800_37: "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-37r2.pdf",
  NIST_800_53: "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53r5.pdf",
  NIST_PRIVACY_FRAMEWORK: "https://www.nist.gov/privacy-framework",

  // ===== Risk axes (recommended concept nodes) =====
  AI_RISK: "PASTE_NOTION_PAGE_LINK",
  CYBER_RISK: "PASTE_NOTION_PAGE_LINK",
  PRIVACY_RISK: "PASTE_NOTION_PAGE_LINK",
  SUPPLYCHAIN_RISK: "PASTE_NOTION_PAGE_LINK",
  SECTOR_RISK: "PASTE_NOTION_PAGE_LINK",

  // ===== Layer overview meta nodes (recommended) =====
  PRINCIPLES_LAYER: "PASTE_NOTION_PAGE_LINK",
  HARDLAW_LAYER: "PASTE_NOTION_PAGE_LINK",
  MANAGEMENT_SYSTEM_LAYER: "PASTE_NOTION_PAGE_LINK",
  OPERATIONAL_FRAMEWORK_LAYER: "PASTE_NOTION_PAGE_LINK",
  };

  window.__open = (key) => {
    const url = NOTION_LINKS[key];
    if (!url || url === "PASTE_NOTION_LINK") {
      alert(`尚未設定 Notion 連結：${key}\n請在 NOTION_LINKS 中貼上該筆 Notion Page 的 Share-to-web 連結。`);
      return;
    }
    window.open(url, "_blank", "noopener,noreferrer");
  };

  window.__showMissing = () => {
    const missing = Object.entries(NOTION_LINKS)
      .filter(([_, v]) => !v || v === "PASTE_NOTION_LINK")
      .map(([k]) => k);
    alert(missing.length ? `尚未設定連結（${missing.length}）：\n` + missing.join("\n") : "全部 Node Key 都已設定連結 ✅");
  };

  // ====== Tabs (re-render mermaid after switching) ======
  const tabs = document.querySelectorAll(".tab");
  const pages = document.querySelectorAll(".page");

  tabs.forEach(t => t.addEventListener("click", async () => {
    const id = t.getAttribute("data-tab");

    tabs.forEach(x => x.classList.remove("active"));
    t.classList.add("active");

    pages.forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");

    window.scrollTo({ top: 0, behavior: "smooth" });

    // Critical: render mermaid after tab switch
    if (window.__renderAllMermaid) await window.__renderAllMermaid();
  }));
</script>

</body>
</html>
